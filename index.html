<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ToDo</title>
	<style>
		body {
			background: dimgray;
		}

		.task_output_post_high{
			background: indianred;
		}
		.task_output_post_normal{
			background:skyblue;
		}
		.task_output_post_low{
			background: lightgreen;
		}
		.task_output_post_name{
			font-size: 30px;
		}
		/*優先順位のラジオと期日を横並びで表示する*/
		.float{
			float:left;
			margin: 10px;
		}

		.sort_float{
			float:left;
			margin:10px;
			border: solid 1px black;
		}
	</style>
	<script>
		// チェックボックスの値がtrueの数を求めるときに必要な変数を定義 初期値0
		let count_checked_true = 0;

		// https://tenshoku-miti.com/takepon/javascript-add-default-date/　（21/06/2023　にパクった）
  		window.onload = function () {
    		let today = new Date();
    		today.setDate(today.getDate());
    		let yyyy = today.getFullYear();
    		let mm = ("0" + (today.getMonth() + 1)).slice(-2);
    		let dd = ("0" + today.getDate()).slice(-2);
    		document.getElementById("today").value = yyyy + '-' + mm + '-' + dd;
  		}
		// 配列を作って、そこにタスク内容と優先度と日時を格納する。　ちゃんと入ってるか確認するために、一時的に出力する。
 		function make_new_array(){
 			const name = document.getElementById('task_imput_name').value;

 			const text = document.getElementById('task_input_text').value;
 			console.log("text:"+text);//デバック用

 			// ラジオボタンのうちチェックされたものだけを得る
 			// .item() , .checked　が必要らしい　pri=の.valueはhighとかlowとか入れたやつが返される。　for()の中のiは初期値1にしたらちゃんと動いた
 			const checkValue =document.getElementsByName('priority');
 			let pri = ' ';
 			for(let i=1;i<4;i++){
 				if(checkValue.item(i).checked){
 					pri = checkValue.item(i).value;
 				}
 			}

 			// 優先度を日本語に変換する関数を生成　お手本.js l:419からのパクリ(switch文をif文で置き換えた)
 			const get_pri_jp = (priority) => {
        		let str = '';
        		if(priority == 'high'){
        			str = '高い';
        		}else if (priority == 'normal'){
        			str = '普通';
        		}else if (priority == 'low'){
        			str = '低い';
        		}
        		return str;
    		};
    		pri = get_pri_jp(pri);
 			const array = [name,text,pri];
 			console.log("array:"+array);

 			// <div></div>内に新しくhtmlを記述する方法　保存したタスクを表示する用
 			let doc = document.getElementById("output");
 			let doc_high=`
 				<div class="task_output_post[]">
 					<div class="task_output_post_high">
 						<div class="task_output_post_high_name">
 							タスク名：${name}
 						</div>
 						<div class="task_output_post_high_text">
 							タスクの内容：${text}
 						</div>
 						<div class="task_output_post_high_priority">
 							優先度：${pri}
 						</div>
 						<div class="task_output_post_button">
 							<input type="checkbox" name="delete_task_radio[]" onclick="1"/> タスク完了
 						</div>
 					</div>
 				</div>
 			` ;

 			let doc_normal = `
 				<div class="task_output_post[]">
 					<div class="task_output_post_normal">
 						<div class="task_output_post_normal_name">
 							タスク名：${name}
 						</div>
 						<div class="task_output_post_normal_text">
 							タスクの内容：${text}
 						</div>
 						<div class="task_output_post_normal_priority">
 							優先度：${pri}
 						</div>
 						<div class="task_output_post_button">
 							<input type="checkbox" name="delete_task_radio[]" value="1"/> タスク完了
 						</div
 					</div>
 				</div>
 			`;

 			let doc_low = `
 				<div class="task_output_post[]">
 					<div class="task_output_post_low">
 						<div class="task_output_post_low_name">
 							タスク名：${name}
 						</div>
 						<div class="task_output_post_low_text">
 							タスクの内容：${text}
 						</div>
 						<div class="task_output_post_low_priority">
 							優先度：${pri}
 						</div>
 						<div class="task_output_post_button">
 							<input type="checkbox" name="delete_task_radio[]" value="1"/> タスク完了
 						</div
 					</div>
 				</div>
 			`;
 			// 入力したものを全部出力できるようにした(全部足す)
 			const normal_html_post = (h) =>{
 				if(pri == "高い"){
 					h += doc_high;
 				}else if (pri == "普通"){
 					h += doc_normal;
 				}else if (pri == "低い"){
 					h += doc_low;
 				}
 				return h;
 			};
 			let html = doc;
 			html.innerHTML += normal_html_post(html);

 			// let doc1 = document.getElementById("output_aritcle");
 			// doc1.innerHTML = '<div><p>（テスト）入力した内容：['+ array+ ']</p></div>';


 			// ユーザーエージェント（どの機種、どのアプリから開いているか）判別：後でやる（優先度低い）
 			

 			// ブラウザ保存
 			//localStorage.setItem(key, value);
 		}
 			// 削除用関数　（未完成===詰み）
 		const checkboxes = document.getElementsByClassName('task_output_post[]');
 		const delete_task = ()=>{
 			console.log('デバック用（削除関数）：開始');
 			let delete_task_array = document.getElementsByName('delete_task_radio[]');
 			let checked_true = document.getElementsByName('delete_task_radio[]').checked;

 			// チェックボックスがtrueの数を求める
 			for(let i=0;i<delete_task_array.length;i++){
 				if(delete_task_array[i].checked == true){
 					count_checked_true += 1;
 				}
 			}
 			console.log('デバック用：count_checked_true='+count_checked_true);

 			for(let i=0;i<delete_task_array.length;i++){
 				console.log('デバック用：forループ'+i+'回目');
 				console.log(i+'個目のチェックボックスの値='+delete_task_array[i].checked);
 				for(let j=0;j<delete_task_array.length;j++){
 					if(delete_task_array[j].checked == true){
 					 	checkboxes[j].remove();
 					}
 				}			
  			}
 			console.log('デバック用（削除関数）：終了');
 		};

 		// 優先度順並び替え
 		const fun_sort_priority = () =>{
 			console.log('デバック用：優先度順並び替え');
 		};
	</script>
</head>
<body>
	<main>
		<h1>ToDo</h1>
		<form action="#" id="form">
			<!-- タスク内容：テキストタイプ -->
			<input id="task_imput_name" type="text" required placeholder="タスク名を入力してくだい" size="140" />

			<textarea id="task_input_text" cols="140" rows="5" placeholder="タスクを入力してください"></textarea>

			<fieldset class="task_input_priority" ><!-- 優先度:ラジオタイプでやる -->
				<div id="task_input_priority" class="float" name="priority">
				<legend>優先度</legend>
				<input id="task_input_priority_high" class="task_input_priority" name="priority" type="radio" value="high" checked />高い
				<input id="task_input_priority_normal" class="task_input_priority" name="priority"  type="radio" value="normal" />普通
				<input id="task_input_priority_low" class="task_input_priority" name="priority"  type="radio" value="low" />低い
				</div>
				<!-- 期限：デイトタイプ　-->
				<div id="task_input_limit" class="float">
				<legend>期限</legend>
				<input class="task_input_date" type="date" id="today" />
				</div>
			</fieldset>

			<input id="task_button" type="submit" value="追加" onclick="make_new_array()" />
			<input id="sort_priority" type="submit" value="優先度順" onclick="fun_sort_priority()" />
 			<input class="task_output_post_normal_delte_submit" type="submit" onclick="delete_task()" value="削除"/>
		</form>
		<div id="output" >
			<div id="output_aritcle">
				
			</div>
		</div>
	</main>
</body>
</html>
